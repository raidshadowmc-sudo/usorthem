
{% extends "base.html" %}

{% block title %}Управление бейджами{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="page-header mb-4">
                <h1 class="h2 text-warning">
                    <i class="fas fa-medal me-3"></i>Управление бейджами
                </h1>
                <p class="text-muted">Создание, редактирование и управление бейджами игроков</p>
            </div>

            <!-- Quick Stats -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>{{ badges|length }}</h4>
                                    <p class="mb-0">Всего бейджей</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-medal fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>{{ badges|selectattr('is_active')|list|length }}</h4>
                                    <p class="mb-0">Активных</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>{{ badge_stats|sum(attribute='assigned_count') }}</h4>
                                    <p class="mb-0">Присвоено</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-dark">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>{{ badges|selectattr('rarity', 'equalto', 'legendary')|list|length + badges|selectattr('rarity', 'equalto', 'mythic')|list|length }}</h4>
                                    <p class="mb-0">Редких</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-gem fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="row mb-4">
                <div class="col-12">
                    <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#createBadgeModal">
                        <i class="fas fa-plus me-2"></i>Создать бейдж
                    </button>
                    <button type="button" class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#assignBadgeModal">
                        <i class="fas fa-user-plus me-2"></i>Присвоить бейдж
                    </button>
                    <button type="button" class="btn btn-info me-2" data-bs-toggle="modal" data-bs-target="#bulkActionsModal">
                        <i class="fas fa-list me-2"></i>Массовые действия
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="location.reload()">
                        <i class="fas fa-sync me-2"></i>Обновить
                    </button>
                </div>
            </div>

            <!-- Badges List -->
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>Все бейджи
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>Превью</th>
                                    <th>Название</th>
                                    <th>Описание</th>
                                    <th>Редкость</th>
                                    <th>Присвоено</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in badge_stats %}
                                {% set badge = stat.badge %}
                                <tr>
                                    <td>
                                        <div class="badge-preview d-flex align-items-center">
                                            {% if badge.has_gradient and badge.gradient_start and badge.gradient_end %}
                                                <span class="badge rounded-pill px-3 py-2 me-2 {{ 'badge-animated' if badge.is_animated else '' }}" 
                                                      style="background: linear-gradient(45deg, {{ badge.gradient_start }}, {{ badge.gradient_end }}); 
                                                             color: {{ badge.color }}; 
                                                             border: 2px solid {{ badge.border_color }};">
                                            {% else %}
                                                <span class="badge rounded-pill px-3 py-2 me-2 {{ 'badge-animated' if badge.is_animated else '' }}" 
                                                      style="background-color: {{ badge.background_color }}; 
                                                             color: {{ badge.color }}; 
                                                             border: 2px solid {{ badge.border_color }};">
                                            {% endif %}
                                                {% if badge.emoji_url %}
                                                    <img src="{{ badge.emoji_url }}" class="emoji me-1" alt="emoji" style="width: 16px; height: 16px;">
                                                {% elif badge.emoji %}
                                                    {{ badge.emoji }}
                                                {% else %}
                                                    <i class="{{ badge.icon }} me-1"></i>
                                                {% endif %}
                                                {{ badge.display_name }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <strong>{{ badge.display_name }}</strong><br>
                                        <small class="text-muted">{{ badge.name }}</small>
                                    </td>
                                    <td>
                                        <small>{{ badge.description or 'Без описания' }}</small>
                                    </td>
                                    <td>
                                        {% if badge.rarity == 'common' %}
                                            <span class="badge bg-secondary">Обычный</span>
                                        {% elif badge.rarity == 'uncommon' %}
                                            <span class="badge bg-success">Необычный</span>
                                        {% elif badge.rarity == 'rare' %}
                                            <span class="badge bg-primary">Редкий</span>
                                        {% elif badge.rarity == 'epic' %}
                                            <span class="badge bg-warning text-dark">Эпический</span>
                                        {% elif badge.rarity == 'legendary' %}
                                            <span class="badge bg-danger">Легендарный</span>
                                        {% elif badge.rarity == 'mythic' %}
                                            <span class="badge" style="background: linear-gradient(45deg, #9400d3, #4b0082); color: white;">Мифический</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ stat.assigned_count }}</span>
                                        {% if stat.assigned_count > 0 %}
                                            <button class="btn btn-sm btn-outline-info ms-1" onclick="showBadgeUsers({{ badge.id }})">
                                                <i class="fas fa-users"></i>
                                            </button>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if badge.is_active %}
                                            <span class="badge bg-success">Активен</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Неактивен</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="editBadge({{ badge.id }})" title="Редактировать">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-outline-info" onclick="duplicateBadge({{ badge.id }})" title="Дублировать">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="btn btn-outline-warning" onclick="toggleBadgeStatus({{ badge.id }})" title="Переключить статус">
                                                <i class="fas fa-toggle-on"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteBadge({{ badge.id }})" title="Удалить">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Players with Badges Section -->
            <div class="card mt-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-users me-2"></i>Игроки с бейджами
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>Игрок</th>
                                    <th>Бейджи</th>
                                    <th>Видимые</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player in players %}
                                {% set player_badges = player.get_badges() %}
                                {% if player_badges %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img src="{{ player.minecraft_skin_url }}" 
                                                 class="me-2" 
                                                 style="width: 32px; height: 32px; image-rendering: pixelated;">
                                            <div>
                                                <strong>{{ player.nickname }}</strong><br>
                                                <small class="text-muted">Уровень {{ player.level }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="badge-list">
                                            {% for player_badge in player_badges %}
                                            {% set badge = player_badge.badge %}
                                            {% if badge.has_gradient and badge.gradient_start and badge.gradient_end %}
                                                <span class="badge rounded-pill me-1 mb-1 {{ 'badge-animated' if badge.is_animated else '' }}" 
                                                      style="background: linear-gradient(45deg, {{ badge.gradient_start }}, {{ badge.gradient_end }}); 
                                                             color: {{ badge.color }}; 
                                                             border: 1px solid {{ badge.border_color }};">
                                            {% else %}
                                                <span class="badge rounded-pill me-1 mb-1 {{ 'badge-animated' if badge.is_animated else '' }}" 
                                                      style="background-color: {{ badge.background_color }}; 
                                                             color: {{ badge.color }}; 
                                                             border: 1px solid {{ badge.border_color }};">
                                            {% endif %}
                                                {% if badge.emoji_url %}
                                                    <img src="{{ badge.emoji_url }}" class="emoji me-1" alt="emoji" style="width: 12px; height: 12px;">
                                                {% elif badge.emoji %}
                                                    {{ badge.emoji }}
                                                {% else %}
                                                    <i class="{{ badge.icon }} me-1"></i>
                                                {% endif %}
                                                {{ badge.display_name }}
                                            </span>
                                            {% endfor %}
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-success">{{ player_badges|selectattr('is_visible')|list|length }}</span>
                                        /
                                        <span class="badge bg-secondary">{{ player_badges|length }}</span>
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="manageBadges({{ player.id }})" title="Управление бейджами">
                                                <i class="fas fa-cog"></i>
                                            </button>
                                            <button class="btn btn-outline-warning" onclick="toggleAllVisibility({{ player.id }})" title="Переключить видимость всех">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="removeAllBadges({{ player.id }})" title="Удалить все бейджи">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Badge Modal -->
<div class="modal fade" id="createBadgeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>Создать новый бейдж
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('create_badge') }}" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Системное название</label>
                                <input type="text" class="form-control" name="name" required>
                                <small class="text-muted">Уникальное имя для системы (например: first_kill)</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Отображаемое название</label>
                                <input type="text" class="form-control" name="display_name" required>
                                <small class="text-muted">Название, которое видят игроки</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Описание</label>
                                <textarea class="form-control" name="description" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Редкость</label>
                                <select class="form-select" name="rarity">
                                    <option value="common">Обычный</option>
                                    <option value="uncommon">Необычный</option>
                                    <option value="rare">Редкий</option>
                                    <option value="epic">Эпический</option>
                                    <option value="legendary">Легендарный</option>
                                    <option value="mythic">Мифический</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Иконка (Font Awesome)</label>
                                <input type="text" class="form-control" name="icon" value="fas fa-medal">
                                <small class="text-muted">Класс Font Awesome иконки</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Эмодзи (текст)</label>
                                <input type="text" class="form-control" name="emoji" maxlength="10">
                                <small class="text-muted">Текстовый эмодзи (например: 🏆)</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Кастомный эмодзи (файл)</label>
                                <input type="file" class="form-control" name="emoji_file" accept="image/*">
                                <small class="text-muted">PNG, JPG, GIF (макс. 256KB)</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">URL эмодзи</label>
                                <input type="text" class="form-control" name="emoji_url">
                                <small class="text-muted">Прямая ссылка на изображение</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Цвет текста</label>
                                <input type="color" class="form-control form-control-color" name="color" value="#ffffff">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Цвет фона</label>
                                <input type="color" class="form-control form-control-color" name="background_color" value="#343a40">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Цвет границы</label>
                                <input type="color" class="form-control form-control-color" name="border_color" value="#ffd700">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" name="has_gradient" id="hasGradient">
                                <label class="form-check-label" for="hasGradient">
                                    Использовать градиент
                                </label>
                            </div>
                            <div id="gradientOptions" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">Начальный цвет градиента</label>
                                    <input type="color" class="form-control form-control-color" name="gradient_start" value="#ffd700">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Конечный цвет градиента</label>
                                    <input type="color" class="form-control form-control-color" name="gradient_end" value="#ffaa00">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" name="is_animated" id="isAnimated">
                                <label class="form-check-label" for="isAnimated">
                                    Анимированный бейдж
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Badge Preview -->
                    <div class="mb-3">
                        <label class="form-label">Предварительный просмотр</label>
                        <div class="p-3 border rounded">
                            <span id="badgePreview" class="badge rounded-pill px-3 py-2" style="background-color: #343a40; color: #ffffff; border: 2px solid #ffd700;">
                                <i class="fas fa-medal me-1"></i>Пример бейджа
                            </span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="submit" class="btn btn-primary">Создать бейдж</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Assign Badge Modal -->
<div class="modal fade" id="assignBadgeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">
                    <i class="fas fa-user-plus me-2"></i>Присвоить бейдж игроку
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('assign_badge') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Игрок</label>
                        <select class="form-select" name="player_id" required>
                            <option value="">Выберите игрока</option>
                            {% for player in players %}
                            <option value="{{ player.id }}">{{ player.nickname }} (Уровень {{ player.level }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Бейдж</label>
                        <select class="form-select" name="badge_id" required>
                            <option value="">Выберите бейдж</option>
                            {% for badge in badges %}
                            {% if badge.is_active %}
                            <option value="{{ badge.id }}">{{ badge.display_name }} ({{ badge.rarity }})</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="submit" class="btn btn-success">Присвоить</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bulk Actions Modal -->
<div class="modal fade" id="bulkActionsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">
                    <i class="fas fa-list me-2"></i>Массовые действия
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Операции с бейджами</h6>
                        <button class="btn btn-warning w-100 mb-2" onclick="bulkToggleStatus()">
                            <i class="fas fa-toggle-on me-2"></i>Переключить статус всех
                        </button>
                        <button class="btn btn-success w-100 mb-2" onclick="createDefaultBadges()">
                            <i class="fas fa-magic me-2"></i>Создать стандартные бейджи
                        </button>
                        <button class="btn btn-info w-100 mb-2" onclick="exportBadges()">
                            <i class="fas fa-download me-2"></i>Экспорт всех бейджей
                        </button>
                    </div>
                    <div class="col-md-6">
                        <h6>Операции с игроками</h6>
                        <button class="btn btn-primary w-100 mb-2" onclick="assignRandomBadges()">
                            <i class="fas fa-random me-2"></i>Случайные бейджи
                        </button>
                        <button class="btn btn-secondary w-100 mb-2" onclick="resetAllVisibility()">
                            <i class="fas fa-eye-slash me-2"></i>Сбросить видимость
                        </button>
                        <button class="btn btn-danger w-100 mb-2" onclick="removeAllPlayerBadges()">
                            <i class="fas fa-trash-alt me-2"></i>Удалить все присвоения
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>

<style>
.badge-animated {
    animation: badgeGlow 2s ease-in-out infinite alternate;
}

@keyframes badgeGlow {
    from { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
    to { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.6); }
}

.badge-preview:hover {
    transform: scale(1.05);
    transition: transform 0.2s ease;
}

.emoji {
    vertical-align: middle;
}

.table th {
    border-color: #495057;
}

.table td {
    border-color: #495057;
    vertical-align: middle;
}

.badge-list {
    max-width: 300px;
}

.form-control-color {
    width: 100%;
    height: 38px;
}
</style>

<script>
// Badge preview functionality
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('#createBadgeModal form');
    const preview = document.getElementById('badgePreview');
    
    if (form && preview) {
        const inputs = ['display_name', 'icon', 'emoji', 'color', 'background_color', 'border_color', 'has_gradient', 'gradient_start', 'gradient_end', 'is_animated'];
        
        inputs.forEach(inputName => {
            const input = form.querySelector(`[name="${inputName}"]`);
            if (input) {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            }
        });
        
        function updatePreview() {
            const displayName = form.querySelector('[name="display_name"]').value || 'Пример бейджа';
            const icon = form.querySelector('[name="icon"]').value || 'fas fa-medal';
            const emoji = form.querySelector('[name="emoji"]').value;
            const color = form.querySelector('[name="color"]').value;
            const backgroundColor = form.querySelector('[name="background_color"]').value;
            const borderColor = form.querySelector('[name="border_color"]').value;
            const hasGradient = form.querySelector('[name="has_gradient"]').checked;
            const gradientStart = form.querySelector('[name="gradient_start"]').value;
            const gradientEnd = form.querySelector('[name="gradient_end"]').value;
            const isAnimated = form.querySelector('[name="is_animated"]').checked;
            
            let background = backgroundColor;
            if (hasGradient) {
                background = `linear-gradient(45deg, ${gradientStart}, ${gradientEnd})`;
            }
            
            preview.style.background = background;
            preview.style.color = color;
            preview.style.border = `2px solid ${borderColor}`;
            preview.className = `badge rounded-pill px-3 py-2 ${isAnimated ? 'badge-animated' : ''}`;
            
            let iconHtml = '';
            if (emoji) {
                iconHtml = `${emoji} `;
            } else {
                iconHtml = `<i class="${icon} me-1"></i>`;
            }
            
            preview.innerHTML = iconHtml + displayName;
        }
    }
    
    // Toggle gradient options
    const gradientCheckbox = document.getElementById('hasGradient');
    const gradientOptions = document.getElementById('gradientOptions');
    
    if (gradientCheckbox && gradientOptions) {
        gradientCheckbox.addEventListener('change', function() {
            gradientOptions.style.display = this.checked ? 'block' : 'none';
        });
    }
});

// Badge management functions
function editBadge(badgeId) {
    // Implement edit functionality
    alert('Функция редактирования в разработке');
}

function duplicateBadge(badgeId) {
    if (confirm('Создать копию этого бейджа?')) {
        // Implement duplication
        alert('Функция дублирования в разработке');
    }
}

function toggleBadgeStatus(badgeId) {
    if (confirm('Изменить статус активности бейджа?')) {
        // Implement status toggle
        fetch(`/admin/toggle_badge_status/${badgeId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Ошибка при изменении статуса');
            }
        });
    }
}

function deleteBadge(badgeId) {
    if (confirm('ВНИМАНИЕ! Это действие нельзя отменить.\n\nУдалить бейдж и все его присвоения?')) {
        fetch(`/admin/remove_badge_permanently/${badgeId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Ошибка при удалении бейджа');
            }
        });
    }
}

function showBadgeUsers(badgeId) {
    // Show users with this badge
    alert('Показать пользователей с этим бейджем (в разработке)');
}

function manageBadges(playerId) {
    // Open badge management for specific player
    alert('Управление бейджами игрока (в разработке)');
}

function toggleAllVisibility(playerId) {
    if (confirm('Переключить видимость всех бейджей игрока?')) {
        // Implement visibility toggle
        alert('Функция в разработке');
    }
}

function removeAllBadges(playerId) {
    if (confirm('ВНИМАНИЕ! Удалить ВСЕ бейджи у этого игрока?')) {
        fetch(`/admin/remove_all_player_badges/${playerId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Ошибка при удалении бейджей');
            }
        });
    }
}

// Bulk actions
function bulkToggleStatus() {
    if (confirm('Переключить статус активности всех бейджей?')) {
        alert('Функция массового переключения в разработке');
    }
}

function createDefaultBadges() {
    if (confirm('Создать стандартный набор бейджей?')) {
        fetch('/admin/create_default_badges', {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Стандартные бейджи созданы!');
                location.reload();
            } else {
                alert('Ошибка при создании бейджей');
            }
        });
    }
}

function exportBadges() {
    window.open('/admin/export_badges', '_blank');
}

function assignRandomBadges() {
    if (confirm('Присвоить случайные бейджи всем игрокам?')) {
        alert('Функция случайного присвоения в разработке');
    }
}

function resetAllVisibility() {
    if (confirm('Сбросить настройки видимости бейджей у всех игроков?')) {
        alert('Функция сброса видимости в разработке');
    }
}

function removeAllPlayerBadges() {
    if (confirm('ВНИМАНИЕ! Удалить ВСЕ присвоения бейджей у ВСЕХ игроков?\n\nЭто действие нельзя отменить!')) {
        alert('Функция массового удаления в разработке');
    }
}
</script>
{% endblock %}
