
{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–∞–º–∏{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="page-header mb-4">
                <h1 class="h2 text-warning">
                    <i class="fas fa-medal me-3"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–∞–º–∏
                </h1>
                <p class="text-muted">–°–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–∞–º–∏ –∏–≥—Ä–æ–∫–æ–≤</p>
            </div>

            <!-- Quick Stats -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>{{ badges|length }}</h4>
                                    <p class="mb-0">–í—Å–µ–≥–æ –±–µ–π–¥–∂–µ–π</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-medal fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>{{ badges|selectattr('is_active')|list|length }}</h4>
                                    <p class="mb-0">–ê–∫—Ç–∏–≤–Ω—ã—Ö</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>{{ badge_stats|sum(attribute='assigned_count') }}</h4>
                                    <p class="mb-0">–ü—Ä–∏—Å–≤–æ–µ–Ω–æ</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-dark">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>{{ badges|selectattr('rarity', 'equalto', 'legendary')|list|length + badges|selectattr('rarity', 'equalto', 'mythic')|list|length }}</h4>
                                    <p class="mb-0">–†–µ–¥–∫–∏—Ö</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-gem fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="row mb-4">
                <div class="col-12">
                    <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#createBadgeModal">
                        <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –±–µ–π–¥–∂
                    </button>
                    <button type="button" class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#assignBadgeModal">
                        <i class="fas fa-user-plus me-2"></i>–ü—Ä–∏—Å–≤–æ–∏—Ç—å –±–µ–π–¥–∂
                    </button>
                    <button type="button" class="btn btn-info me-2" data-bs-toggle="modal" data-bs-target="#bulkActionsModal">
                        <i class="fas fa-list me-2"></i>–ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="location.reload()">
                        <i class="fas fa-sync me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <!-- Badges List -->
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>–í—Å–µ –±–µ–π–¥–∂–∏
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>–ü—Ä–µ–≤—å—é</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–†–µ–¥–∫–æ—Å—Ç—å</th>
                                    <th>–ü—Ä–∏—Å–≤–æ–µ–Ω–æ</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in badge_stats %}
                                {% set badge = stat.badge %}
                                <tr>
                                    <td>
                                        <div class="badge-preview d-flex align-items-center">
                                            {% if badge.has_gradient and badge.gradient_start and badge.gradient_end %}
                                                <span class="badge rounded-pill px-3 py-2 me-2 {{ 'badge-animated' if badge.is_animated else '' }}" 
                                                      style="background: linear-gradient(45deg, {{ badge.gradient_start }}, {{ badge.gradient_end }}); 
                                                             color: {{ badge.color }}; 
                                                             border: 2px solid {{ badge.border_color }};">
                                            {% else %}
                                                <span class="badge rounded-pill px-3 py-2 me-2 {{ 'badge-animated' if badge.is_animated else '' }}" 
                                                      style="background-color: {{ badge.background_color }}; 
                                                             color: {{ badge.color }}; 
                                                             border: 2px solid {{ badge.border_color }};">
                                            {% endif %}
                                                {% if badge.emoji_url %}
                                                    <img src="{{ badge.emoji_url }}" class="emoji me-1" alt="emoji" style="width: 16px; height: 16px;">
                                                {% elif badge.emoji %}
                                                    {{ badge.emoji }}
                                                {% else %}
                                                    <i class="{{ badge.icon }} me-1"></i>
                                                {% endif %}
                                                {{ badge.display_name }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <strong>{{ badge.display_name }}</strong><br>
                                        <small class="text-muted">{{ badge.name }}</small>
                                    </td>
                                    <td>
                                        <small>{{ badge.description or '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è' }}</small>
                                    </td>
                                    <td>
                                        {% if badge.rarity == 'common' %}
                                            <span class="badge bg-secondary">–û–±—ã—á–Ω—ã–π</span>
                                        {% elif badge.rarity == 'uncommon' %}
                                            <span class="badge bg-success">–ù–µ–æ–±—ã—á–Ω—ã–π</span>
                                        {% elif badge.rarity == 'rare' %}
                                            <span class="badge bg-primary">–†–µ–¥–∫–∏–π</span>
                                        {% elif badge.rarity == 'epic' %}
                                            <span class="badge bg-warning text-dark">–≠–ø–∏—á–µ—Å–∫–∏–π</span>
                                        {% elif badge.rarity == 'legendary' %}
                                            <span class="badge bg-danger">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</span>
                                        {% elif badge.rarity == 'mythic' %}
                                            <span class="badge" style="background: linear-gradient(45deg, #9400d3, #4b0082); color: white;">–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ stat.assigned_count }}</span>
                                        {% if stat.assigned_count > 0 %}
                                            <button class="btn btn-sm btn-outline-info ms-1" onclick="showBadgeUsers({{ badge.id }})">
                                                <i class="fas fa-users"></i>
                                            </button>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if badge.is_active %}
                                            <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                        {% else %}
                                            <span class="badge bg-secondary">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="editBadge({{ badge.id }})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-outline-info" onclick="duplicateBadge({{ badge.id }})" title="–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="btn btn-outline-warning" onclick="toggleBadgeStatus({{ badge.id }})" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å">
                                                <i class="fas fa-toggle-on"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteBadge({{ badge.id }})" title="–£–¥–∞–ª–∏—Ç—å">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Players with Badges Section -->
            <div class="card mt-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-users me-2"></i>–ò–≥—Ä–æ–∫–∏ —Å –±–µ–π–¥–∂–∞–º–∏
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>–ò–≥—Ä–æ–∫</th>
                                    <th>–ë–µ–π–¥–∂–∏</th>
                                    <th>–í–∏–¥–∏–º—ã–µ</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player in players %}
                                {% set player_badges = player.get_badges() %}
                                {% if player_badges %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img src="{{ player.minecraft_skin_url }}" 
                                                 class="me-2" 
                                                 style="width: 32px; height: 32px; image-rendering: pixelated;">
                                            <div>
                                                <strong>{{ player.nickname }}</strong><br>
                                                <small class="text-muted">–£—Ä–æ–≤–µ–Ω—å {{ player.level }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="badge-list">
                                            {% for player_badge in player_badges %}
                                            {% set badge = player_badge.badge %}
                                            {% if badge.has_gradient and badge.gradient_start and badge.gradient_end %}
                                                <span class="badge rounded-pill me-1 mb-1 {{ 'badge-animated' if badge.is_animated else '' }}" 
                                                      style="background: linear-gradient(45deg, {{ badge.gradient_start }}, {{ badge.gradient_end }}); 
                                                             color: {{ badge.color }}; 
                                                             border: 1px solid {{ badge.border_color }};">
                                            {% else %}
                                                <span class="badge rounded-pill me-1 mb-1 {{ 'badge-animated' if badge.is_animated else '' }}" 
                                                      style="background-color: {{ badge.background_color }}; 
                                                             color: {{ badge.color }}; 
                                                             border: 1px solid {{ badge.border_color }};">
                                            {% endif %}
                                                {% if badge.emoji_url %}
                                                    <img src="{{ badge.emoji_url }}" class="emoji me-1" alt="emoji" style="width: 12px; height: 12px;">
                                                {% elif badge.emoji %}
                                                    {{ badge.emoji }}
                                                {% else %}
                                                    <i class="{{ badge.icon }} me-1"></i>
                                                {% endif %}
                                                {{ badge.display_name }}
                                            </span>
                                            {% endfor %}
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-success">{{ player_badges|selectattr('is_visible')|list|length }}</span>
                                        /
                                        <span class="badge bg-secondary">{{ player_badges|length }}</span>
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="manageBadges({{ player.id }})" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–∞–º–∏">
                                                <i class="fas fa-cog"></i>
                                            </button>
                                            <button class="btn btn-outline-warning" onclick="toggleAllVisibility({{ player.id }})" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="removeAllBadges({{ player.id }})" title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±–µ–π–¥–∂–∏">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Badge Modal -->
<div class="modal fade" id="createBadgeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –±–µ–π–¥–∂
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('create_badge') }}" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–°–∏—Å—Ç–µ–º–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                                <input type="text" class="form-control" name="name" required>
                                <small class="text-muted">–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è —Å–∏—Å—Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: first_kill)</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                                <input type="text" class="form-control" name="display_name" required>
                                <small class="text-muted">–ù–∞–∑–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤–∏–¥—è—Ç –∏–≥—Ä–æ–∫–∏</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                <textarea class="form-control" name="description" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">–†–µ–¥–∫–æ—Å—Ç—å</label>
                                <select class="form-select" name="rarity">
                                    <option value="common">–û–±—ã—á–Ω—ã–π</option>
                                    <option value="uncommon">–ù–µ–æ–±—ã—á–Ω—ã–π</option>
                                    <option value="rare">–†–µ–¥–∫–∏–π</option>
                                    <option value="epic">–≠–ø–∏—á–µ—Å–∫–∏–π</option>
                                    <option value="legendary">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</option>
                                    <option value="mythic">–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–ò–∫–æ–Ω–∫–∞ (Font Awesome)</label>
                                <input type="text" class="form-control" name="icon" value="fas fa-medal">
                                <small class="text-muted">–ö–ª–∞—Å—Å Font Awesome –∏–∫–æ–Ω–∫–∏</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">–≠–º–æ–¥–∑–∏ (—Ç–µ–∫—Å—Ç)</label>
                                <input type="text" class="form-control" name="emoji" maxlength="10">
                                <small class="text-muted">–¢–µ–∫—Å—Ç–æ–≤—ã–π —ç–º–æ–¥–∑–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: üèÜ)</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">–ö–∞—Å—Ç–æ–º–Ω—ã–π —ç–º–æ–¥–∑–∏ (—Ñ–∞–π–ª)</label>
                                <input type="file" class="form-control" name="emoji_file" accept="image/*">
                                <small class="text-muted">PNG, JPG, GIF (–º–∞–∫—Å. 256KB)</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">URL —ç–º–æ–¥–∑–∏</label>
                                <input type="text" class="form-control" name="emoji_url">
                                <small class="text-muted">–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
                                <input type="color" class="form-control form-control-color" name="color" value="#ffffff">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">–¶–≤–µ—Ç —Ñ–æ–Ω–∞</label>
                                <input type="color" class="form-control form-control-color" name="background_color" value="#343a40">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">–¶–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã</label>
                                <input type="color" class="form-control form-control-color" name="border_color" value="#ffd700">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" name="has_gradient" id="hasGradient">
                                <label class="form-check-label" for="hasGradient">
                                    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥—Ä–∞–¥–∏–µ–Ω—Ç
                                </label>
                            </div>
                            <div id="gradientOptions" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">–ù–∞—á–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞</label>
                                    <input type="color" class="form-control form-control-color" name="gradient_start" value="#ffd700">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">–ö–æ–Ω–µ—á–Ω—ã–π —Ü–≤–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞</label>
                                    <input type="color" class="form-control form-control-color" name="gradient_end" value="#ffaa00">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" name="is_animated" id="isAnimated">
                                <label class="form-check-label" for="isAnimated">
                                    –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–µ–π–¥–∂
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Badge Preview -->
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</label>
                        <div class="p-3 border rounded">
                            <span id="badgePreview" class="badge rounded-pill px-3 py-2" style="background-color: #343a40; color: #ffffff; border: 2px solid #ffd700;">
                                <i class="fas fa-medal me-1"></i>–ü—Ä–∏–º–µ—Ä –±–µ–π–¥–∂–∞
                            </span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –±–µ–π–¥–∂</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Assign Badge Modal -->
<div class="modal fade" id="assignBadgeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">
                    <i class="fas fa-user-plus me-2"></i>–ü—Ä–∏—Å–≤–æ–∏—Ç—å –±–µ–π–¥–∂ –∏–≥—Ä–æ–∫—É
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('assign_badge') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–ò–≥—Ä–æ–∫</label>
                        <select class="form-select" name="player_id" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</option>
                            {% for player in players %}
                            <option value="{{ player.id }}">{{ player.nickname }} (–£—Ä–æ–≤–µ–Ω—å {{ player.level }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ë–µ–π–¥–∂</label>
                        <select class="form-select" name="badge_id" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–µ–π–¥–∂</option>
                            {% for badge in badges %}
                            {% if badge.is_active %}
                            <option value="{{ badge.id }}">{{ badge.display_name }} ({{ badge.rarity }})</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-success">–ü—Ä–∏—Å–≤–æ–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bulk Actions Modal -->
<div class="modal fade" id="bulkActionsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">
                    <i class="fas fa-list me-2"></i>–ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–µ–π–¥–∂–∞–º–∏</h6>
                        <button class="btn btn-warning w-100 mb-2" onclick="bulkToggleStatus()">
                            <i class="fas fa-toggle-on me-2"></i>–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö
                        </button>
                        <button class="btn btn-success w-100 mb-2" onclick="createDefaultBadges()">
                            <i class="fas fa-magic me-2"></i>–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–µ–π–¥–∂–∏
                        </button>
                        <button class="btn btn-info w-100 mb-2" onclick="exportBadges()">
                            <i class="fas fa-download me-2"></i>–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –±–µ–π–¥–∂–µ–π
                        </button>
                    </div>
                    <div class="col-md-6">
                        <h6>–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∏–≥—Ä–æ–∫–∞–º–∏</h6>
                        <button class="btn btn-primary w-100 mb-2" onclick="assignRandomBadges()">
                            <i class="fas fa-random me-2"></i>–°–ª—É—á–∞–π–Ω—ã–µ –±–µ–π–¥–∂–∏
                        </button>
                        <button class="btn btn-secondary w-100 mb-2" onclick="resetAllVisibility()">
                            <i class="fas fa-eye-slash me-2"></i>–°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å
                        </button>
                        <button class="btn btn-danger w-100 mb-2" onclick="removeAllPlayerBadges()">
                            <i class="fas fa-trash-alt me-2"></i>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<style>
.badge-animated {
    animation: badgeGlow 2s ease-in-out infinite alternate;
}

@keyframes badgeGlow {
    from { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
    to { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.6); }
}

.badge-preview:hover {
    transform: scale(1.05);
    transition: transform 0.2s ease;
}

.emoji {
    vertical-align: middle;
}

.table th {
    border-color: #495057;
}

.table td {
    border-color: #495057;
    vertical-align: middle;
}

.badge-list {
    max-width: 300px;
}

.form-control-color {
    width: 100%;
    height: 38px;
}
</style>

<script>
// Badge preview functionality
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('#createBadgeModal form');
    const preview = document.getElementById('badgePreview');
    
    if (form && preview) {
        const inputs = ['display_name', 'icon', 'emoji', 'color', 'background_color', 'border_color', 'has_gradient', 'gradient_start', 'gradient_end', 'is_animated'];
        
        inputs.forEach(inputName => {
            const input = form.querySelector(`[name="${inputName}"]`);
            if (input) {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            }
        });
        
        function updatePreview() {
            const displayName = form.querySelector('[name="display_name"]').value || '–ü—Ä–∏–º–µ—Ä –±–µ–π–¥–∂–∞';
            const icon = form.querySelector('[name="icon"]').value || 'fas fa-medal';
            const emoji = form.querySelector('[name="emoji"]').value;
            const color = form.querySelector('[name="color"]').value;
            const backgroundColor = form.querySelector('[name="background_color"]').value;
            const borderColor = form.querySelector('[name="border_color"]').value;
            const hasGradient = form.querySelector('[name="has_gradient"]').checked;
            const gradientStart = form.querySelector('[name="gradient_start"]').value;
            const gradientEnd = form.querySelector('[name="gradient_end"]').value;
            const isAnimated = form.querySelector('[name="is_animated"]').checked;
            
            let background = backgroundColor;
            if (hasGradient) {
                background = `linear-gradient(45deg, ${gradientStart}, ${gradientEnd})`;
            }
            
            preview.style.background = background;
            preview.style.color = color;
            preview.style.border = `2px solid ${borderColor}`;
            preview.className = `badge rounded-pill px-3 py-2 ${isAnimated ? 'badge-animated' : ''}`;
            
            let iconHtml = '';
            if (emoji) {
                iconHtml = `${emoji} `;
            } else {
                iconHtml = `<i class="${icon} me-1"></i>`;
            }
            
            preview.innerHTML = iconHtml + displayName;
        }
    }
    
    // Toggle gradient options
    const gradientCheckbox = document.getElementById('hasGradient');
    const gradientOptions = document.getElementById('gradientOptions');
    
    if (gradientCheckbox && gradientOptions) {
        gradientCheckbox.addEventListener('change', function() {
            gradientOptions.style.display = this.checked ? 'block' : 'none';
        });
    }
});

// Badge management functions
function editBadge(badgeId) {
    // Implement edit functionality
    alert('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
}

function duplicateBadge(badgeId) {
    if (confirm('–°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é —ç—Ç–æ–≥–æ –±–µ–π–¥–∂–∞?')) {
        // Implement duplication
        alert('–§—É–Ω–∫—Ü–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function toggleBadgeStatus(badgeId) {
    if (confirm('–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±–µ–π–¥–∂–∞?')) {
        // Implement status toggle
        fetch(`/admin/toggle_badge_status/${badgeId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞');
            }
        });
    }
}

function deleteBadge(badgeId) {
    if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.\n\n–£–¥–∞–ª–∏—Ç—å –±–µ–π–¥–∂ –∏ –≤—Å–µ –µ–≥–æ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è?')) {
        fetch(`/admin/remove_badge_permanently/${badgeId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–µ–π–¥–∂–∞');
            }
        });
    }
}

function showBadgeUsers(badgeId) {
    // Show users with this badge
    alert('–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —ç—Ç–∏–º –±–µ–π–¥–∂–µ–º (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
}

function manageBadges(playerId) {
    // Open badge management for specific player
    alert('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–∞–º–∏ –∏–≥—Ä–æ–∫–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
}

function toggleAllVisibility(playerId) {
    if (confirm('–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö –±–µ–π–¥–∂–µ–π –∏–≥—Ä–æ–∫–∞?')) {
        // Implement visibility toggle
        alert('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function removeAllBadges(playerId) {
    if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –£–¥–∞–ª–∏—Ç—å –í–°–ï –±–µ–π–¥–∂–∏ —É —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞?')) {
        fetch(`/admin/remove_all_player_badges/${playerId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–µ–π–¥–∂–µ–π');
            }
        });
    }
}

// Bulk actions
function bulkToggleStatus() {
    if (confirm('–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –±–µ–π–¥–∂–µ–π?')) {
        alert('–§—É–Ω–∫—Ü–∏—è –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function createDefaultBadges() {
    if (confirm('–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –Ω–∞–±–æ—Ä –±–µ–π–¥–∂–µ–π?')) {
        fetch('/admin/create_default_badges', {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–µ–π–¥–∂–∏ —Å–æ–∑–¥–∞–Ω—ã!');
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–µ–π–¥–∂–µ–π');
            }
        });
    }
}

function exportBadges() {
    window.open('/admin/export_badges', '_blank');
}

function assignRandomBadges() {
    if (confirm('–ü—Ä–∏—Å–≤–æ–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –±–µ–π–¥–∂–∏ –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º?')) {
        alert('–§—É–Ω–∫—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function resetAllVisibility() {
    if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –±–µ–π–¥–∂–µ–π —É –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤?')) {
        alert('–§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function removeAllPlayerBadges() {
    if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –£–¥–∞–ª–∏—Ç—å –í–°–ï –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è –±–µ–π–¥–∂–µ–π —É –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        alert('–§—É–Ω–∫—Ü–∏—è –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}
</script>
{% endblock %}
